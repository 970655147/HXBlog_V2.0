<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>数据列表页面</title>
    <!-- layui.css -->
    <link href="./plugin/layui/css/layui.css" rel="stylesheet"/>
    <style>

        tr td:not(:nth-child(0)),
        tr th:not(:nth-child(0)) {
            text-align: center;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            -o-text-overflow: ellipsis;
            -icab-text-overflow: ellipsis;
            -khtml-text-overflow: ellipsis;
            -moz-text-overflow: ellipsis;
            -webkit-text-overflow: ellipsis;
        }

        #dataConsole {
            text-align: center;
        }

        /*分页页容量样式*/
        /*可选*/
        .layui-laypage {
            display: block;
        }

        /*可选*/
        .layui-laypage > * {
            float: left;
        }

        /*可选*/
        .layui-laypage .laypage-extend-pagesize {
            float: right;
        }

        /*可选*/
        .layui-laypage:after {
            content: ".";
            display: block;
            height: 0;
            clear: both;
            visibility: hidden;
        }

        /*必须*/
        .layui-laypage .laypage-extend-pagesize {
            height: 30px;
            line-height: 30px;
            margin: 0px;
            border: none;
            font-weight: 400;
        }

        /*分页页容量样式END*/
    </style>
</head>
<body>
<fieldset id="dataList" class="layui-elem-field layui-field-title sys-list-field" style="display:none;">
    <legend style="text-align:center;">博客类别列表</legend>
    <button class="layui-btn" style="margin:10px auto auto auto;display: block" onclick="layui.datalist.addData()">
        <i class="layui-icon">&#xe608;</i> 添加类别
    </button>
    <div class="layui-field-box layui-form">
        <div id="dataContent" class="">
            <!-- typeData -->
        </div>
        <div id="pageNav"></div>
    </div>
</fieldset>
<!-- layui.js -->
<script src="./plugin/layui/layui.js"></script>
<!-- layui规范化用法 -->
<script type="text/javascript">
    layui.define(['layer', 'form'], function (exports) {
        var $ = layui.jquery;
        var layer = layui.layer;
        var form = layui.form();

        initilData();

        function initilData() {
            var index = layer.load(1);
            //模拟数据加载
            setTimeout(function () {
                layer.close(index);
                $.ajax({
                    url: "/type/list",
                    type: "GET",
                    data: {},
                    success: function (resp) {
                        var html = '';
                        html += '<table style="table-layout: fixed" class="layui-table" lay-even>';
                        html += '<colgroup><col width="40"><col width="200"><col width="40"><col width="40"></colgroup>';
                        html += '<thead><tr><th>编号</th><th>博客类型名</th><th colspan="2">操作</th></tr></thead>';
                        html += '<tbody>';
                        if(resp.success) {
                            for (var i in resp.data) {
                                var item = resp.data[i];
                                html += '<tr>';
                                html += '<td>' + item.id + '</td>';
                                html += '<td>' + item.name + '</td>';
                                html += '<td><button class="layui-btn layui-btn-small layui-btn-normal" onclick="layui.datalist.editData(' + item.id + ',\'' + item.name + '\')"><i class="layui-icon">&#xe642;</i></button></td>';
                                html += '<td><button class="layui-btn layui-btn-small layui-btn-danger" onclick="layui.datalist.deleteData(' + item.id + ')"><i class="layui-icon">&#xe640;</i></button></td>';
                                html += '</tr>';
                            }
                        }
                        html += '</tbody></table>';
                        $('#dataContent').html(html);
                    }
                });

                $('#dataConsole,#dataList').attr('style', 'display:block'); //显示FiledBox
            }, 500);
        }

        //输出接口，主要是两个函数，一个删除一个编辑
        var datalist = {
            deleteData: function (id) {
                layer.confirm('您确定要删除吗？', {
                    btn: ['确定', '取消'] //按钮
                }, function () {
                    $.ajax({
                        url: '/admin/type/remove',
                        type: 'POST',
                        data: {
                            "id" : id
                        },
                        success: function (resp) {
                            if (resp.success) {
                                layer.alert('删除成功!', {
                                    closeBtn: 0,
                                    icon: 1
                                }, function () {
                                    window.location.href = "/static/admin/blogTypeManage.html"
                                });
                            } else {
                                layer.alert('删除失败,该类别下存在博文!', {icon: 5});
                            }
                        }
                    });
                }, function () {

                });
            },
            editData: function (id, typeName) {
                var html = '';
                html += '<div class="layui-form layui-form-pane" >';
                html += '<label class="layui-form-label" style="border: none" >类别名称:</label>';
                html += '<textarea  id="edit_name" style="width:87%;margin: auto;color: #000!important;" name="name" class="layui-textarea" lay-verify="required" >' + typeName + '</textarea>';
                html += '<input id="edit_id" type="hidden" name="id" value="' + id + '"/>';
                html += '<div class="layui-form-item">';
                html += '<div class="layui-input-inline" style="margin:10px auto 0 auto;display: block;float: none;">';
                html += '<button class="layui-btn" id="editSubmit" onclick="layui.datalist.editTypePost()" lay-submit="" lay-filter="demo1">立即提交</button>';
                html += '<button type="reset" class="layui-btn layui-btn-primary">重置</button>';
                html += '</div>';
                html += '</div>';
                html += '</div>';

                layer.open({
                    type: 1,
                    skin: 'layui-layer-rim', //加上边框
                    area: '420px', //宽高
                    title: '修改类别',
                    content: html
                });
            },
            addData: function () {
                var html = '';
                html += '<div class="layui-form layui-form-pane" >';
                html += '<label class="layui-form-label" style="border: none" name="content" >类别名称:</label>';
                html += '<input id="add_name"  style="width:87%;margin: auto;color: #000!important;" name="name" lay-verify="required" class="layui-input" >';
                html += '<div class="layui-form-item">';
                html += '<div class="layui-input-inline" style="margin:10px auto 0 auto;display: block;float: none;">';
                html += '<button class="layui-btn" id="submit" onclick="layui.datalist.addTypePost()"  lay-submit="" lay-filter="demo1">添加</button>';
                html += '<button type="reset" class="layui-btn layui-btn-primary">重置</button>';
                html += '</div>';
                html += '</div>';
                html += '</div>';
                layer.open({
                    type: 1,
                    skin: 'layui-layer-rim', //加上边框
                    area: '420px', //宽高
                    title: '添加类别',
                    content: html
                });
            },
            editTypePost : function() {
                $.ajax({
                    url : "/admin/type/update",
                    type : "POST",
                    data :  {
                        "id" : $("#edit_id").val(),
                        "name" : $("#edit_name").val()
                    },
                    success : function (resp) {
                        if (resp.success) {
                            layer.alert('修改成功!', {
                                closeBtn: 0,
                                icon: 1
                            }, function () {
                                window.location.href = "/static/admin/blogTypeManage.html"
                            });
                        } else {
                            layer.alert('修改失败,该类别下存在博文!', {icon: 5});
                        }
                    }
                });
            },
            addTypePost : function() {
                $.ajax({
                    url : "/admin/type/add",
                    type : "POST",
                    data :  {
                        "name" : $("#add_name").val()
                    },
                    success : function (resp) {
                        if (resp.success) {
                            layer.alert('添加类型成功!', {
                                closeBtn: 0,
                                icon: 1
                            }, function () {
                                window.location.href = "/static/admin/blogTypeManage.html"
                            });
                        } else {
                            layer.alert('修改失败,该类别下存在博文!', {icon: 5});
                        }
                    }
                });
            }
        };
        exports('datalist', datalist);
    });

</script>

<script src="../js/jquery-1.11.1.min.js"></script>
<script src="../js/vue.js"></script>
<script src="js/blogTypeManage.js"></script>

</body>
</html>